PKG_CXXFLAGS = -I. `PKG_CONFIG_PATH=lib/pkgconfig:$(PKG_CONFIG_PATH) pkg-config --cflags libarchive` -Wno-keyword-macro
PKG_LIBS = `PKG_CONFIG_PATH=lib/pkgconfig:$(PKG_CONFIG_PATH) pkg-config --libs libarchive`

.PHONY: all libarchive clean

all: $(OBJECTS) $(SHLIB)

$(OBJECTS): libarchive


libarchive-3.3.1/Makefile:
	(cd libarchive-3.3.1 && \
./configure \
--cache-file=../config.cache \
CC="$(CC)" \
CFLAGS="$(CFLAGS) $(CPICFLAGS)" \
AR="$(AR)" \
ARFLAGS=$(ARFLAGS) \
--enable-shared=no \
--enable-static=yes \
--prefix=$(PWD) \
--disable-bsdtar \
--disable-bsdcat \
--disable-bsdcpio \
--disable-maintainer-mode \
--without-nettle \
--without-xml2 \
--without-expat)

libarchive: libarchive-3.3.1/Makefile
	(cd libarchive-3.3.1 && \
make libarchive.la libarchive_fe.la && \
make install-includeHEADERS install-libLTLIBRARIES install-pkgconfigDATA)

clean:
	rm -f $(OBJECTS) $(SHLIB)
	rm -rf include lib
